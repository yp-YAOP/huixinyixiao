<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æ•°å­—è®¤çŸ¥è®­ç»ƒ - ä¸»é¢˜å¢å¼ºç‰ˆ</title>
    <style>
      /* ğŸ¯ ä¸»é¢˜å¢å¼ºç‰ˆ - æ”¯æŒ4ç§é«˜çº§é…è‰²ä¸»é¢˜ */

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      /* ğŸ¯ CSSå˜é‡ç³»ç»Ÿ - æ”¯æŒåŠ¨æ€ä¸»é¢˜åˆ‡æ¢ */
      :root {
        /* é»˜è®¤ä¸»é¢˜ï¼šç´«é‡‘é…è‰² */
        --primary-bg: linear-gradient(135deg, #2d1b69, #1a0f3a);
        --primary-color: #ffd700;
        --secondary-color: #4b0082;
        --accent-color: #ff6b6b;
        --text-primary: #ffffff;
        --text-secondary: #e0e0e0;
        --text-muted: #b0b0b0;
        --success-color: #4cd964;
        --error-color: #ff4757;
        --warning-color: #ffa502;
        --border-color: rgba(255, 215, 0, 0.3);
        --surface-bg: rgba(255, 255, 255, 0.05);
        --surface-border: rgba(255, 215, 0, 0.3);
        --shadow-color: rgba(255, 215, 0, 0.3);
        --glow-color: rgba(255, 215, 0, 0.8);
      }

      /* ğŸ¯ æ·±ç©ºç°ä¸»é¢˜ */
      .theme-space-gray {
        --primary-bg: linear-gradient(135deg, #1f1f1f, #0a0a0a);
        --primary-color: #e0e0e0;
        --secondary-color: #4a4a4a;
        --accent-color: #ff6b6b;
        --text-primary: #ffffff;
        --text-secondary: #cccccc;
        --text-muted: #888888;
        --success-color: #4cd964;
        --error-color: #ff4757;
        --warning-color: #ffa502;
        --border-color: rgba(224, 224, 224, 0.3);
        --surface-bg: rgba(255, 255, 255, 0.05);
        --surface-border: rgba(224, 224, 224, 0.3);
        --shadow-color: rgba(224, 224, 224, 0.3);
        --glow-color: rgba(224, 224, 224, 0.8);
      }

      /* ğŸ¯ è–„è·ç»¿ä¸»é¢˜ */
      .theme-mint-green {
        --primary-bg: linear-gradient(135deg, #e8f5e8, #c8e6c9);
        --primary-color: #2e7d32;
        --secondary-color: #81c784;
        --accent-color: #ff6b6b;
        --text-primary: #1b5e20;
        --text-secondary: #2e7d32;
        --text-muted: #4caf50;
        --success-color: #4cd964;
        --error-color: #ff4757;
        --warning-color: #ffa502;
        --border-color: rgba(46, 125, 50, 0.3);
        --surface-bg: rgba(46, 125, 50, 0.05);
        --surface-border: rgba(46, 125, 50, 0.3);
        --shadow-color: rgba(46, 125, 50, 0.3);
        --glow-color: rgba(46, 125, 50, 0.8);
      }

      /* ğŸ¯ çŠç‘šç²‰ä¸»é¢˜ */
      .theme-coral-pink {
        --primary-bg: linear-gradient(135deg, #fff3f0, #ffebee);
        --primary-color: #d32f2f;
        --secondary-color: #ff6b6b;
        --accent-color: #2196f3;
        --text-primary: #b71c1c;
        --text-secondary: #d32f2f;
        --text-muted: #f44336;
        --success-color: #4cd964;
        --error-color: #ff4757;
        --warning-color: #ffa502;
        --border-color: rgba(211, 47, 47, 0.3);
        --surface-bg: rgba(211, 47, 47, 0.05);
        --surface-border: rgba(211, 47, 47, 0.3);
        --shadow-color: rgba(211, 47, 47, 0.3);
        --glow-color: rgba(211, 47, 47, 0.8);
      }

      body {
        font-family: "Microsoft YaHei", Arial, sans-serif;
        background: var(--primary-bg);
        min-height: 100vh;
        color: var(--text-primary);
        overflow-x: hidden;
        transition: all 0.3s ease;
      }

      /* ğŸ¯ ä¸»é¢˜åˆ‡æ¢å™¨ */
      .theme-switcher {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
        background: var(--surface-bg);
        border: 2px solid var(--border-color);
        border-radius: 15px;
        padding: 15px;
        backdrop-filter: blur(10px);
        box-shadow: 0 4px 20px var(--shadow-color);
        min-width: 220px; /* ä¸ºæ¨ªå‘å¸ƒå±€å¢åŠ æœ€å°å®½åº¦ */
      }

      .theme-switcher-title {
        font-size: 0.9rem;
        color: var(--text-secondary);
        text-align: center;
        margin-bottom: 10px;
        font-weight: bold;
      }

      .theme-options {
        display: grid;
        grid-template-columns: repeat(4, 1fr); /* æ”¹ä¸ºæ¨ªå‘4åˆ—å¸ƒå±€ */
        gap: 8px;
      }

      .theme-btn {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        cursor: pointer;
        border: 3px solid transparent;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .theme-btn:hover {
        transform: scale(1.1);
        box-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
      }

      .theme-btn.active {
        border-color: var(--primary-color);
        box-shadow: 0 0 20px var(--glow-color);
        transform: scale(1.15);
      }

      /* ğŸ¯ ä¸»é¢˜æŒ‰é’®å…·ä½“é…è‰² */
      .theme-btn.purple-gold {
        background: linear-gradient(135deg, #4b0082, #ffd700);
      }

      .theme-btn.space-gray {
        background: linear-gradient(135deg, #1f1f1f, #4a4a4a);
      }

      .theme-btn.mint-green {
        background: linear-gradient(135deg, #e8f5e8, #81c784);
      }

      .theme-btn.coral-pink {
        background: linear-gradient(135deg, #fff3f0, #ff6b6b);
      }

      .theme-btn::after {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.3);
        transform: translate(-50%, -50%);
        transition: all 0.3s ease;
      }

      .theme-btn:active::after {
        width: 100%;
        height: 100%;
      }

      .main-container {
        display: grid;
        grid-template-areas:
          "header header header"
          "sidebar camera info"
          "controls controls controls";
        grid-template-columns: 250px 1fr 280px;
        grid-template-rows: auto 1fr auto;
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
        gap: 20px;
        min-height: 100vh;
      }

      .header {
        grid-area: header;
        text-align: center;
        margin-bottom: 20px;
      }

      .header h1 {
        font-size: 2.5rem;
        color: var(--primary-color);
        margin-bottom: 10px;
        text-shadow: 0 0 20px var(--glow-color);
        transition: all 0.3s ease;
      }

      .header p {
        font-size: 1.2rem;
        color: var(--text-secondary);
        opacity: 0.9;
      }

      .task-sidebar {
        grid-area: sidebar;
        background: var(--surface-bg);
        border-radius: 15px;
        padding: 20px;
        border: 2px solid var(--surface-border);
        backdrop-filter: blur(10px);
        transition: all 0.3s ease;
        box-shadow: 0 4px 20px var(--shadow-color);
      }

      .target-display {
        text-align: center;
        padding: 20px;
        background: var(--surface-bg);
        border-radius: 12px;
        margin-bottom: 20px;
        border: 1px solid var(--border-color);
        transition: all 0.3s ease;
      }

      .target-number {
        font-size: 80px;
        color: var(--primary-color);
        font-weight: bold;
        text-shadow: 0 0 30px var(--glow-color);
        line-height: 1;
        transition: all 0.5s ease;
      }

      .target-number.correct {
        animation: correctPulse 0.5s ease 3;
      }
      .target-number.wrong {
        animation: wrongShake 0.3s ease 2;
      }

      @keyframes correctPulse {
        0% {
          box-shadow: 0 0 0 0 var(--success-color);
          transform: scale(1);
        }
        70% {
          box-shadow: 0 0 0 20px transparent;
          transform: scale(1.05);
        }
        100% {
          box-shadow: 0 0 0 0 transparent;
          transform: scale(1);
        }
      }

      @keyframes wrongShake {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-10px);
        }
        75% {
          transform: translateX(10px);
        }
      }

      .finger-guide {
        font-size: 3rem;
        margin: 10px 0;
      }

      .camera-section {
        grid-area: camera;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 15px;
      }

      #camera-container {
        position: relative;
        border: 3px solid var(--primary-color);
        border-radius: 20px;
        overflow: hidden;
        box-shadow: 0 0 30px var(--shadow-color);
        transition: all 0.3s ease;
      }

      #webcam {
        width: 480px;
        height: 360px;
        background: var(--secondary-color);
        display: block;
      }

      #output-canvas {
        position: absolute;
        top: 0;
        left: 0;
        width: 480px;
        height: 360px;
        pointer-events: none;
      }

      .status-panel {
        width: 100%;
        max-width: 480px;
        background: var(--surface-bg);
        border-radius: 15px;
        padding: 15px;
        border: 2px solid var(--surface-border);
        backdrop-filter: blur(10px);
        transition: all 0.3s ease;
      }

      .current-detection {
        text-align: center;
        font-size: 1.8rem;
        color: var(--primary-color);
        font-weight: bold;
        margin-bottom: 10px;
      }

      .confidence-display {
        text-align: center;
        font-size: 1rem;
        color: var(--success-color);
        margin-bottom: 10px;
        font-weight: bold;
      }

      .operation-hints {
        text-align: center;
        font-size: 1.1rem;
        color: var(--text-secondary);
        margin-bottom: 10px;
      }

      .progress-container {
        margin-top: 10px;
      }

      .progress-bar {
        height: 8px;
        background: var(--surface-bg);
        border-radius: 4px;
        overflow: hidden;
        border: 1px solid var(--border-color);
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(
          to right,
          var(--error-color),
          var(--success-color),
          var(--primary-color)
        );
        width: 0%;
        transition: width 0.1s linear;
        border-radius: 4px;
      }

      .progress-text {
        text-align: center;
        font-size: 0.9rem;
        color: var(--text-muted);
        margin-top: 5px;
      }

      .info-sidebar {
        grid-area: info;
        background: var(--surface-bg);
        border-radius: 15px;
        padding: 20px;
        border: 2px solid var(--surface-border);
        backdrop-filter: blur(10px);
        transition: all 0.3s ease;
        box-shadow: 0 4px 20px var(--shadow-color);
      }

      .recognition-title {
        font-size: 1.3rem;
        color: var(--primary-color);
        text-align: center;
        margin-bottom: 15px;
        border-bottom: 1px solid var(--border-color);
        padding-bottom: 10px;
      }

      .finger-analysis {
        margin-bottom: 20px;
      }

      .finger-detail {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px solid var(--border-color);
        font-size: 0.9rem;
      }

      .finger-name {
        color: var(--text-secondary);
        min-width: 60px;
      }

      .finger-metrics {
        display: flex;
        gap: 8px;
        align-items: center;
      }

      .angle-value {
        color: var(--success-color);
        font-weight: bold;
        min-width: 45px;
        text-align: right;
      }

      .status-indicator {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        border: 1px solid var(--text-primary);
        transition: all 0.3s ease;
      }

      .status-indicator.extended {
        background: var(--success-color);
        box-shadow: 0 0 8px var(--success-color);
      }

      .status-indicator.folded {
        background: var(--error-color);
        box-shadow: 0 0 8px var(--error-color);
      }

      .algorithm-status {
        border-top: 1px solid var(--border-color);
        padding-top: 15px;
        margin-top: 15px;
      }

      .status-item {
        margin-bottom: 8px;
        font-size: 0.9rem;
        display: flex;
        justify-content: space-between;
      }

      .status-label {
        color: var(--text-muted);
      }

      .status-value {
        color: var(--primary-color);
        font-weight: bold;
      }

      .stability-indicator {
        display: flex;
        gap: 4px;
        align-items: center;
      }

      .stability-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: var(--text-muted);
        transition: background 0.3s;
      }

      .stability-dot.active {
        background: var(--success-color);
        box-shadow: 0 0 8px var(--success-color);
      }

      .controls {
        grid-area: controls;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        background: var(--surface-bg);
        border-radius: 15px;
        border: 2px solid var(--surface-border);
        backdrop-filter: blur(10px);
        transition: all 0.3s ease;
        box-shadow: 0 4px 20px var(--shadow-color);
      }

      .score-display {
        font-size: 1.8rem;
        color: var(--primary-color);
        font-weight: bold;
      }

      .feedback-area {
        flex: 1;
        text-align: center;
        margin: 0 20px;
        min-height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .feedback {
        font-size: 1.3rem;
        padding: 10px 20px;
        border-radius: 20px;
        font-weight: bold;
        transition: all 0.3s ease;
      }

      .feedback.success {
        color: var(--success-color);
        background: var(--surface-bg);
        border: 1px solid var(--success-color);
      }

      .feedback.error {
        color: var(--error-color);
        background: var(--surface-bg);
        border: 1px solid var(--error-color);
      }

      .feedback.hint {
        color: var(--primary-color);
        background: var(--surface-bg);
        border: 1px solid var(--primary-color);
      }

      .restart-btn {
        padding: 12px 25px;
        font-size: 1.1rem;
        font-weight: bold;
        border: none;
        border-radius: 25px;
        background: linear-gradient(
          45deg,
          var(--accent-color),
          var(--error-color)
        );
        color: var(--text-primary);
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px var(--shadow-color);
      }

      .restart-btn:hover {
        transform: translateY(-2px) scale(1.05);
        box-shadow: 0 6px 20px var(--shadow-color);
      }

      /* ğŸ¯ ä¸»é¢˜åˆ‡æ¢åŠ¨ç”»æ•ˆæœ */
      .theme-transition {
        transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      }

      /* å“åº”å¼è®¾è®¡ */
      @media (max-width: 1200px) {
        .main-container {
          grid-template-areas:
            "header"
            "camera"
            "sidebar"
            "info"
            "controls";
          grid-template-columns: 1fr;
          grid-template-rows: auto auto auto auto auto;
          gap: 15px;
        }

        .task-sidebar,
        .info-sidebar {
          max-width: 600px;
          margin: 0 auto;
        }

        .theme-switcher {
          top: 10px;
          right: 10px;
          padding: 10px;
        }

        .theme-options {
          grid-template-columns: repeat(4, 1fr);
        }

        .theme-btn {
          width: 35px;
          height: 35px;
        }
      }

      @media (max-width: 768px) {
        #webcam,
        #output-canvas {
          width: 320px;
          height: 240px;
        }

        .target-number {
          font-size: 60px;
        }

        .controls {
          flex-direction: column;
          gap: 15px;
        }

        .theme-switcher {
          position: relative;
          top: auto;
          right: auto;
          margin: 10px auto;
          width: fit-content;
        }
      }

      /* ğŸ¯ ä¸»é¢˜åˆ‡æ¢æ—¶çš„ç‰¹æ®Šæ•ˆæœ */
      .theme-changing {
        animation: themeTransition 0.5s ease;
      }

      @keyframes themeTransition {
        0% {
          opacity: 1;
          transform: scale(1);
        }
        50% {
          opacity: 0.8;
          transform: scale(0.98);
        }
        100% {
          opacity: 1;
          transform: scale(1);
        }
      }
      /* ğŸ¯ å“åº”å¼è®¾è®¡ - ç¡®ä¿è®¤çŸ¥è®­ç»ƒåœ¨æ‰€æœ‰è®¾å¤‡ä¸Šå®Œç¾æ˜¾ç¤º */
      body {
        overflow-x: hidden;
        min-height: 100vh;
        font-size: clamp(14px, 2vw, 16px);
      }

      .main-container {
        width: 100%;
        min-height: 100vh;
        padding: 1rem;
        box-sizing: border-box;
      }

      .game-container {
        width: 100%;
        max-width: min(800px, 90vw);
        margin: 0 auto;
        aspect-ratio: 4/3;
        min-height: 400px;
      }

      @media (max-width: 1200px) {
        .game-layout {
          flex-direction: column;
          align-items: center;
          gap: 1.5rem;
        }

        .central-game-area {
          max-width: 100%;
        }

        .info-sidebar {
          width: 100%;
          max-width: 600px;
        }

        #webcam,
        #output-canvas {
          width: min(480px, 90vw);
          height: min(360px, 67.5vw);
        }

        .target-number {
          font-size: 3.5rem;
        }
      }

      @media (max-width: 768px) {
        .game-layout {
          padding: 0.5rem;
          gap: 1rem;
        }

        #webcam,
        #output-canvas {
          width: min(400px, 95vw);
          height: min(300px, 71.25vw);
        }

        .target-number {
          font-size: 3rem;
        }

        .finger-guide {
          font-size: 2rem;
        }

        .current-detection {
          font-size: 1.5rem;
        }

        .controls {
          flex-direction: column;
          gap: 15px;
          padding: 15px;
        }

        .theme-switcher {
          position: relative;
          top: auto;
          right: auto;
          margin: 10px auto 20px;
          width: fit-content;
        }
      }

      @media (max-width: 480px) {
        .target-card,
        .detection-card {
          padding: 1rem;
        }

        .target-number {
          font-size: 2.5rem;
        }

        .finger-guide {
          font-size: 1.8rem;
        }

        .target-instruction {
          font-size: 1rem;
        }

        .theme-instruction {
          font-size: 0.8rem;
        }
      }

      /* æ¨ªå±æ¨¡å¼ä¼˜åŒ– */
      @media (max-height: 500px) and (orientation: landscape) {
        .container {
          padding: 5px;
        }

        .game-container {
          min-height: 200px;
          aspect-ratio: 6/3;
        }

        .card {
          min-height: 40px;
          font-size: 0.7rem;
          padding: 5px;
        }

        .controls {
          flex-direction: row;
          gap: 10px;
          padding: 8px;
        }
      }

      /* ç¡®ä¿æ‰€æœ‰å…ƒç´ ä¸ä¼šæº¢å‡º */
      .game-area,
      .theme-panel,
      .modal {
        max-width: 100vw;
        overflow: hidden;
      }

      /* ä¸»é¢˜é¢æ¿å“åº”å¼ */
      .theme-panel {
        width: min(300px, 90vw);
        max-height: 80vh;
        overflow-y: auto;
      }

      @media (max-width: 480px) {
        .theme-panel {
          width: min(280px, 95vw);
          padding: 15px;
        }

        .theme-option {
          padding: 8px;
          font-size: 0.8rem;
        }
      }

      /* æ•°æ®ä¸Šä¼ æç¤ºæ ·å¼ */
      .upload-notification {
        position: fixed;
        top: 20px;
        right: 20px;
        background: rgba(76, 175, 80, 0.9);
        color: white;
        padding: 10px 15px;
        border-radius: 5px;
        z-index: 10000;
        font-family: Inter, sans-serif;
        font-size: 14px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        transition: all 0.3s ease;
      }
    </style>
  </head>
  <body class="theme-transition">
    <!-- ğŸ¯ ä¸»é¢˜åˆ‡æ¢å™¨ -->
    <div class="theme-switcher">
      <div class="theme-switcher-title">ğŸ¨ é€‰æ‹©ä¸»é¢˜</div>
      <div class="theme-options">
        <div
          class="theme-btn purple-gold active"
          data-theme="purple-gold"
          title="ç´«é‡‘ä¸»é¢˜"
        ></div>
        <div
          class="theme-btn space-gray"
          data-theme="space-gray"
          title="æ·±ç©ºç°ä¸»é¢˜"
        ></div>
        <div
          class="theme-btn mint-green"
          data-theme="mint-green"
          title="è–„è·ç»¿ä¸»é¢˜"
        ></div>
        <div
          class="theme-btn coral-pink"
          data-theme="coral-pink"
          title="çŠç‘šç²‰ä¸»é¢˜"
        ></div>
      </div>
    </div>

    <div class="main-container">
      <!-- ğŸ¯ ä¸»é¢˜åˆ‡æ¢å™¨ -->
      <div class="theme-switcher">
        <div class="theme-switcher-title">ğŸ¨ é€‰æ‹©ä¸»é¢˜</div>
        <div class="theme-options">
          <div
            class="theme-btn purple-gold active"
            data-theme="purple-gold"
            title="ç´«é‡‘ä¸»é¢˜"
          ></div>
          <div
            class="theme-btn space-gray"
            data-theme="space-gray"
            title="æ·±ç©ºç°ä¸»é¢˜"
          ></div>
          <div
            class="theme-btn mint-green"
            data-theme="mint-green"
            title="è–„è·ç»¿ä¸»é¢˜"
          ></div>
          <div
            class="theme-btn coral-pink"
            data-theme="coral-pink"
            title="çŠç‘šç²‰ä¸»é¢˜"
          ></div>
        </div>
      </div>

      <!-- æ ‡é¢˜åŒºåŸŸ -->
      <header class="header">
        <h1>ğŸ§  æ•°å­—è®¤çŸ¥è®­ç»ƒ</h1>
        <p>ä¸»é¢˜å¢å¼ºç‰ˆ - 4ç§é«˜çº§é…è‰²å¯é€‰</p>
      </header>

      <!-- å·¦ä¾§ä»»åŠ¡æ  -->
      <div class="task-sidebar">
        <div class="target-display">
          <div class="target-number" id="targetNumber">3</div>
          <div class="finger-guide" id="fingerGuide">ğŸ¤Ÿ</div>
        </div>
        <div
          style="
            text-align: center;
            color: var(--text-secondary);
            font-size: 1rem;
            margin-bottom: 10px;
          "
        >
          è¯·æ¯”å‡ºå¯¹åº”çš„æ‰‹æŒ‡æ•°é‡
        </div>
        <div
          style="
            text-align: center;
            color: var(--text-muted);
            font-size: 0.9rem;
          "
        >
          æ”¯æŒä¸»é¢˜åˆ‡æ¢ï¼Œä¸ªæ€§åŒ–ä½“éªŒ
        </div>
      </div>

      <!-- ä¸­å¤®æ‘„åƒå¤´åŒº -->
      <div class="camera-section">
        <div id="camera-container">
          <video id="webcam" autoplay muted playsinline></video>
          <canvas id="output-canvas"></canvas>
        </div>

        <div class="status-panel">
          <div class="current-detection" id="currentDetection">å‡†å¤‡è¯†åˆ«...</div>
          <div class="confidence-display" id="confidenceDisplay">
            ç½®ä¿¡åº¦: ç­‰å¾…ä¸­...
          </div>
          <div class="operation-hints" id="operationHints">
            è¯·å°†æ‰‹æ”¾åœ¨æ‘„åƒå¤´å‰
          </div>

          <div class="progress-container">
            <div class="progress-bar">
              <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text" id="progressText">ç­‰å¾…æ‰‹åŠ¿...</div>
          </div>
        </div>
      </div>

      <!-- å³ä¾§è¯¦ç»†è¯†åˆ«ä¿¡æ¯ -->
      <div class="info-sidebar">
        <div class="recognition-title">ğŸ” è¯†åˆ«è¯¦æƒ…</div>

        <!-- æ‰‹æŒ‡è§’åº¦åˆ†æ -->
        <div class="finger-analysis">
          <div class="finger-detail">
            <span class="finger-name">ğŸ‘ æ‹‡æŒ‡</span>
            <div class="finger-metrics">
              <span class="angle-value" id="thumbAngle">--Â°</span>
              <div class="status-indicator folded" id="thumbIndicator"></div>
            </div>
          </div>
          <div class="finger-detail">
            <span class="finger-name">ğŸ‘† é£ŸæŒ‡</span>
            <div class="finger-metrics">
              <span class="angle-value" id="indexAngle">--Â°</span>
              <div class="status-indicator folded" id="indexIndicator"></div>
            </div>
          </div>
          <div class="finger-detail">
            <span class="finger-name">ğŸ–• ä¸­æŒ‡</span>
            <div class="finger-metrics">
              <span class="angle-value" id="middleAngle">--Â°</span>
              <div class="status-indicator folded" id="middleIndicator"></div>
            </div>
          </div>
          <div class="finger-detail">
            <span class="finger-name">ğŸ’ æ— åæŒ‡</span>
            <div class="finger-metrics">
              <span class="angle-value" id="ringAngle">--Â°</span>
              <div class="status-indicator folded" id="ringIndicator"></div>
            </div>
          </div>
          <div class="finger-detail">
            <span class="finger-name">ğŸ¤™ å°æŒ‡</span>
            <div class="finger-metrics">
              <span class="angle-value" id="pinkyAngle">--Â°</span>
              <div class="status-indicator folded" id="pinkyIndicator"></div>
            </div>
          </div>
        </div>

        <!-- ç®—æ³•çŠ¶æ€ -->
        <div class="algorithm-status">
          <div class="status-item">
            <span class="status-label">å½“å‰ä¸»é¢˜:</span>
            <span class="status-value" id="currentTheme">ç´«é‡‘é…è‰²</span>
          </div>
          <div class="status-item">
            <span class="status-label">æ£€æµ‹ç²¾åº¦:</span>
            <span class="status-value" id="detectionPrecision">å‡†å¤‡ä¸­</span>
          </div>
          <div class="status-item">
            <span class="status-label">ç¨³å®šæ€§:</span>
            <div class="stability-indicator" id="stabilityIndicator">
              <div class="stability-dot"></div>
              <div class="stability-dot"></div>
              <div class="stability-dot"></div>
              <div class="stability-dot"></div>
              <div class="stability-dot"></div>
            </div>
          </div>
          <div class="status-item">
            <span class="status-label">ç½®ä¿¡åº¦:</span>
            <span class="status-value" id="algorithmConfidence">0%</span>
          </div>
        </div>
      </div>

      <!-- åº•éƒ¨æ§åˆ¶åŒºåŸŸ -->
      <div class="controls">
        <div class="score-display">å¾—åˆ†ï¼š<span id="scoreDisplay">0</span></div>

        <div class="feedback-area">
          <div class="feedback hint" id="feedback">
            ä¸»é¢˜å¢å¼ºç‰ˆå·²å¯åŠ¨ï¼Œç‚¹å‡»å³ä¸Šè§’åˆ‡æ¢ä¸»é¢˜
          </div>
        </div>

        <button class="restart-btn" id="restartBtn">é‡æ–°å¼€å§‹</button>
      </div>
    </div>

    <!-- MediaPipeä¾èµ– -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4.1646424915/hands.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.min.js"></script>
    
    <!-- æ•°æ®ä¸Šä¼ å·¥å…·åº“ -->
    <script src="gameDataUploader.js"></script>

    <script>
      // ğŸ¯ ä¸»é¢˜å¢å¼ºç‰ˆ - é›†æˆé«˜ç²¾åº¦è¯†åˆ« + å¤šä¸»é¢˜åˆ‡æ¢
      class ThemeEnhancedGame {
        constructor() {
          // æ¸¸æˆçŠ¶æ€
          this.score = 0;
          this.targetNumber = 1;
          this.isGameActive = false;
          
          // ä½¿ç”¨æ–°çš„æ•°æ®ä¸Šä¼ å™¨
          this.dataUploader = null;

          // é«˜ç²¾åº¦è¯†åˆ«å‚æ•°
          this.currentFingers = 0;
          this.fingerHistory = [];
          this.stableFrames = 0;
          this.REQUIRED_FRAMES = 20; // è¿›ä¸€æ­¥å‡å°‘ç¨³å®šå¸§æ•°
          this.HISTORY_SIZE = 5; // å‡å°‘å†å²è®°å½•å¤§å°
          this.CONFIDENCE_THRESHOLD = 0.4; // é™ä½ç½®ä¿¡åº¦é˜ˆå€¼ï¼Œæé«˜æ•æ„Ÿåº¦

          // æ¸¸æˆæ§åˆ¶çŠ¶æ€
          this.waitingForNextRound = false; // ç­‰å¾…ä¸‹ä¸€è½®çš„æ ‡å¿—ä½

          // ğŸ¯ ä¸»é¢˜ç³»ç»Ÿ
          this.themes = {
            "purple-gold": {
              name: "ç´«é‡‘é…è‰²",
              className: "",
            },
            "space-gray": {
              name: "æ·±ç©ºç°",
              className: "theme-space-gray",
            },
            "mint-green": {
              name: "è–„è·ç»¿",
              className: "theme-mint-green",
            },
            "coral-pink": {
              name: "çŠç‘šç²‰",
              className: "theme-coral-pink",
            },
          };

          this.currentThemeName = "purple-gold";

          // è§’åº¦è¯†åˆ«é˜ˆå€¼ - ä¼˜åŒ–é˜ˆå€¼ä½¿è¯†åˆ«æ›´å‡†ç¡®
          this.ANGLE_THRESHOLDS = {
            thumb: 120, // é™ä½æ‹‡æŒ‡é˜ˆå€¼ï¼Œä»140æ”¹ä¸º120
            index: 140, // é™ä½é£ŸæŒ‡é˜ˆå€¼ï¼Œä»160æ”¹ä¸º140
            middle: 140, // é™ä½ä¸­æŒ‡é˜ˆå€¼ï¼Œä»160æ”¹ä¸º140
            ring: 130, // é™ä½æ— åæŒ‡é˜ˆå€¼ï¼Œä»155æ”¹ä¸º130
            pinky: 120, // é™ä½å°æŒ‡é˜ˆå€¼ï¼Œä»150æ”¹ä¸º120
          };

          // DOMå…ƒç´ 
          this.webcam = document.getElementById("webcam");
          this.outputCanvas = document.getElementById("output-canvas");
          this.canvasContext = this.outputCanvas.getContext("2d");
          this.targetNumberDisplay = document.getElementById("targetNumber");
          this.fingerGuide = document.getElementById("fingerGuide");
          this.currentDetection = document.getElementById("currentDetection");
          this.confidenceDisplay = document.getElementById("confidenceDisplay");
          this.operationHints = document.getElementById("operationHints");
          this.progressFill = document.getElementById("progressFill");
          this.progressText = document.getElementById("progressText");
          this.scoreDisplay = document.getElementById("scoreDisplay");
          this.feedback = document.getElementById("feedback");
          this.restartBtn = document.getElementById("restartBtn");

          // è¯†åˆ«ä¿¡æ¯å…ƒç´ 
          this.angleElements = {
            thumb: document.getElementById("thumbAngle"),
            index: document.getElementById("indexAngle"),
            middle: document.getElementById("middleAngle"),
            ring: document.getElementById("ringAngle"),
            pinky: document.getElementById("pinkyAngle"),
          };

          this.indicatorElements = {
            thumb: document.getElementById("thumbIndicator"),
            index: document.getElementById("indexIndicator"),
            middle: document.getElementById("middleIndicator"),
            ring: document.getElementById("ringIndicator"),
            pinky: document.getElementById("pinkyIndicator"),
          };

          this.detectionPrecision =
            document.getElementById("detectionPrecision");
          this.stabilityIndicator =
            document.getElementById("stabilityIndicator");
          this.algorithmConfidence = document.getElementById(
            "algorithmConfidence"
          );
          this.currentThemeDisplay = document.getElementById("currentTheme");

          // ä¸»é¢˜æŒ‰é’®
          this.themeButtons = document.querySelectorAll(".theme-btn");

          // MediaPipe
          this.hands = null;
          this.camera = null;

          this.init();
        }

        init() {
          this.initThemeSystem();
          this.initMediaPipe();
          this.addEventListeners();
          this.generateTargetNumber();
          this.startGame();
        }

        // ğŸ¯ åˆå§‹åŒ–ä¸»é¢˜ç³»ç»Ÿ
        initThemeSystem() {
          // è¯»å–ä¿å­˜çš„ä¸»é¢˜åå¥½
          const savedTheme =
            localStorage.getItem("game-theme") || "purple-gold";
          this.switchTheme(savedTheme);

          // ç»‘å®šä¸»é¢˜æŒ‰é’®äº‹ä»¶
          this.themeButtons.forEach((btn) => {
            btn.addEventListener("click", () => {
              const theme = btn.dataset.theme;
              this.switchTheme(theme);
            });
          });
        }

        // ğŸ¯ ä¸»é¢˜åˆ‡æ¢æ ¸å¿ƒå‡½æ•°
        switchTheme(themeName) {
          if (!this.themes[themeName]) return;

          const body = document.body;
          const theme = this.themes[themeName];

          // æ·»åŠ åˆ‡æ¢åŠ¨ç”»
          body.classList.add("theme-changing");

          // ç§»é™¤æ‰€æœ‰ä¸»é¢˜ç±»
          Object.values(this.themes).forEach((t) => {
            if (t.className) {
              body.classList.remove(t.className);
            }
          });

          // åº”ç”¨æ–°ä¸»é¢˜
          if (theme.className) {
            body.classList.add(theme.className);
          }

          // æ›´æ–°å½“å‰ä¸»é¢˜
          this.currentThemeName = themeName;
          this.currentThemeDisplay.textContent = theme.name;

          // æ›´æ–°æŒ‰é’®çŠ¶æ€
          this.updateThemeButtonState();

          // ä¿å­˜ä¸»é¢˜åå¥½
          localStorage.setItem("game-theme", themeName);

          // æ’­æ”¾ä¸»é¢˜åˆ‡æ¢éŸ³æ•ˆ
          this.playThemeChangeSound();

          // ç§»é™¤åŠ¨ç”»ç±»
          setTimeout(() => {
            body.classList.remove("theme-changing");
          }, 500);

          console.log(`ğŸ¨ ä¸»é¢˜å·²åˆ‡æ¢è‡³: ${theme.name}`);
        }

        // ğŸ¯ æ›´æ–°ä¸»é¢˜æŒ‰é’®çŠ¶æ€
        updateThemeButtonState() {
          this.themeButtons.forEach((btn) => {
            if (btn.dataset.theme === this.currentThemeName) {
              btn.classList.add("active");
            } else {
              btn.classList.remove("active");
            }
          });
        }

        // ğŸ¯ ä¸»é¢˜åˆ‡æ¢éŸ³æ•ˆ
        playThemeChangeSound() {
          try {
            const audioContext = new (window.AudioContext ||
              window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(
              1200,
              audioContext.currentTime + 0.1
            );
            oscillator.type = "sine";

            gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(
              0.01,
              audioContext.currentTime + 0.2
            );

            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.2);
          } catch (e) {
            // éŸ³æ•ˆæ’­æ”¾å¤±è´¥ï¼Œé™é»˜å¤„ç†
          }
        }

        initMediaPipe() {
          this.hands = new Hands({
            locateFile: (file) =>
              `https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4.1646424915/${file}`,
          });

          this.hands.setOptions({
            maxNumHands: 1,
            modelComplexity: 1,
            minDetectionConfidence: 0.8,
            minTrackingConfidence: 0.8,
          });

          this.hands.onResults((results) => {
            this.onHandsResults(results);
          });

          this.initCamera();
        }

        async initCamera() {
          try {
            // æ£€æŸ¥æµè§ˆå™¨å…¼å®¹æ€§
            if (!this.checkBrowserCompatibility()) {
              return;
            }

            this.outputCanvas.width = 480;
            this.outputCanvas.height = 360;

            this.camera = new Camera(this.webcam, {
              onFrame: async () => {
                await this.hands.send({ image: this.webcam });
              },
              width: 480,
              height: 360,
              facingMode: "user",
            });

            await this.camera.start();
            this.operationHints.textContent = "å¤šä¸»é¢˜è¯†åˆ«ç³»ç»Ÿå·²å¯åŠ¨";
            this.detectionPrecision.textContent = "å·²å°±ç»ª";
          } catch (error) {
            console.error("æ‘„åƒå¤´å¯åŠ¨å¤±è´¥:", error);
            this.handleCameraError(error);
          }
        }

        checkBrowserCompatibility() {
          console.log('ğŸ” æ£€æŸ¥æµè§ˆå™¨å…¼å®¹æ€§...');
          console.log('å½“å‰åè®®:', window.location.protocol);
          console.log('å½“å‰åŸŸå:', window.location.host);
          
          // æ£€æŸ¥æ˜¯å¦æ”¯æŒ getUserMedia
          if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
            console.error('âŒ æµè§ˆå™¨ä¸æ”¯æŒ getUserMedia API');
            this.operationHints.textContent = "æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒæ‘„åƒå¤´åŠŸèƒ½";
            this.operationHints.style.color = "var(--error-color)";
            
            // æ˜¾ç¤ºè¯¦ç»†çš„è§£å†³æ–¹æ¡ˆ
            setTimeout(() => {
              alert('æµè§ˆå™¨ä¸æ”¯æŒæ‘„åƒå¤´åŠŸèƒ½\n\nè§£å†³æ–¹æ¡ˆï¼š\n1. è¯·ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„Chromeã€Firefoxæˆ–Edgeæµè§ˆå™¨\n2. ç¡®ä¿æµè§ˆå™¨å·²æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬');
            }, 1000);
            return false;
          }

          // æ£€æŸ¥HTTPSåè®®
          if (window.location.protocol !== 'https:' && window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {
            console.error('âŒ æ‘„åƒå¤´åŠŸèƒ½éœ€è¦HTTPSåè®®');
            this.operationHints.textContent = "æ‘„åƒå¤´åŠŸèƒ½éœ€è¦å®‰å…¨è¿æ¥";
            this.operationHints.style.color = "var(--warning-color)";
            
            // ç”ŸæˆHTTPSé“¾æ¥
            const httpsUrl = window.location.href.replace('http://', 'https://').replace(':3000', ':3443');
            
            setTimeout(() => {
              const result = confirm('æ‘„åƒå¤´åŠŸèƒ½éœ€è¦HTTPSå®‰å…¨è¿æ¥\n\nå½“å‰ä½¿ç”¨çš„æ˜¯HTTPè¿æ¥ï¼Œæ— æ³•è®¿é—®æ‘„åƒå¤´\n\nç‚¹å‡»"ç¡®å®š"è·³è½¬åˆ°HTTPSç‰ˆæœ¬\nç‚¹å‡»"å–æ¶ˆ"ç»§ç»­ä½¿ç”¨ï¼ˆä½†æ— æ³•ä½¿ç”¨æ‘„åƒå¤´ï¼‰');
              if (result) {
                window.location.href = httpsUrl;
              } else {
                this.operationHints.textContent = "æ— æ‘„åƒå¤´æ¨¡å¼ï¼ˆä»…æ”¯æŒé¼ æ ‡æ“ä½œï¼‰";
                this.operationHints.style.color = "var(--warning-color)";
              }
            }, 1000);
            return false;
          }

          console.log('âœ… æµè§ˆå™¨å…¼å®¹æ€§æ£€æŸ¥é€šè¿‡');
          return true;
        }

        handleCameraError(error) {
          console.error('æ‘„åƒå¤´é”™è¯¯è¯¦æƒ…:', error);
          
          if (error.name === 'NotAllowedError') {
            this.operationHints.textContent = "è¯·å…è®¸æ‘„åƒå¤´æƒé™è®¿é—®";
            this.operationHints.style.color = "var(--warning-color)";
            
            setTimeout(() => {
              alert('æ‘„åƒå¤´æƒé™è¢«æ‹’ç»\n\nè§£å†³æ–¹æ¡ˆï¼š\n1. ç‚¹å‡»åœ°å€æ å·¦ä¾§çš„æ‘„åƒå¤´å›¾æ ‡\n2. é€‰æ‹©"å…è®¸"æ‘„åƒå¤´è®¿é—®\n3. åˆ·æ–°é¡µé¢é‡è¯•');
            }, 1000);
          } else if (error.name === 'NotFoundError') {
            this.operationHints.textContent = "æœªæ£€æµ‹åˆ°æ‘„åƒå¤´è®¾å¤‡";
            this.operationHints.style.color = "var(--error-color)";
            
            setTimeout(() => {
              alert('æœªæ£€æµ‹åˆ°æ‘„åƒå¤´è®¾å¤‡\n\nè¯·æ£€æŸ¥ï¼š\n1. æ‘„åƒå¤´æ˜¯å¦æ­£ç¡®è¿æ¥\n2. æ‘„åƒå¤´æ˜¯å¦è¢«å…¶ä»–åº”ç”¨å ç”¨\n3. è®¾å¤‡ç®¡ç†å™¨ä¸­æ‘„åƒå¤´çŠ¶æ€');
            }, 1000);
          } else if (error.name === 'NotReadableError') {
            this.operationHints.textContent = "æ‘„åƒå¤´è®¾å¤‡è¢«å ç”¨";
            this.operationHints.style.color = "var(--error-color)";
            
            setTimeout(() => {
              alert('æ‘„åƒå¤´è®¾å¤‡è¢«å ç”¨\n\nè§£å†³æ–¹æ¡ˆï¼š\n1. å…³é—­å…¶ä»–ä½¿ç”¨æ‘„åƒå¤´çš„åº”ç”¨\n2. é‡å¯æµè§ˆå™¨\n3. é‡æ–°è¿æ¥æ‘„åƒå¤´è®¾å¤‡');
            }, 1000);
          } else {
            this.operationHints.textContent = "æ‘„åƒå¤´å¯åŠ¨å¤±è´¥ï¼Œè¯·æ£€æŸ¥è®¾å¤‡";
            this.operationHints.style.color = "var(--error-color)";
            
            setTimeout(() => {
              alert(`æ‘„åƒå¤´å¯åŠ¨å¤±è´¥\n\né”™è¯¯ç±»å‹: ${error.name}\né”™è¯¯ä¿¡æ¯: ${error.message}\n\nå»ºè®®ï¼š\n1. åˆ·æ–°é¡µé¢é‡è¯•\n2. æ£€æŸ¥æ‘„åƒå¤´æƒé™è®¾ç½®\n3. ä½¿ç”¨HTTPSè¿æ¥`);
            }, 1000);
          }
        }

        onHandsResults(results) {
          this.canvasContext.clearRect(
            0,
            0,
            this.outputCanvas.width,
            this.outputCanvas.height
          );

          if (
            results.multiHandLandmarks &&
            results.multiHandLandmarks.length > 0
          ) {
            const landmarks = results.multiHandLandmarks[0];

            const palmSize = this.calculatePalmSize(landmarks);
            if (palmSize < 0.08) {
              this.operationHints.textContent =
                "è¯·å°†æ‰‹é è¿‘æ‘„åƒå¤´ï¼ˆè·ç¦»30cmå†…ï¼‰";
              this.resetDetection();
              return;
            } else {
              this.operationHints.textContent = "è·ç¦»åˆé€‚ï¼Œæ­£åœ¨è¯†åˆ«...";
            }

            this.drawAdvancedHandLandmarks(landmarks);

            const fingerAnalysis = this.analyzeFingerAngles(landmarks);
            this.updateFingerDisplay(fingerAnalysis);

            const currentCount = this.calculateFingerCount(fingerAnalysis);
            this.updateStabilityAnalysis(currentCount);

            this.updateDetectionInfo(fingerAnalysis, palmSize);
            this.processStableGesture();
          } else {
            this.operationHints.textContent = "è¯·å°†æ‰‹æ”¾åœ¨æ‘„åƒå¤´å‰";
            this.resetDetection();
          }
        }

        // ä½¿ç”¨æ”¹è¿›çš„æ‰‹æŒ‡è¯†åˆ«ç®—æ³• - åŸºäºå…³èŠ‚ç‚¹ä½ç½®è€Œéè§’åº¦
        analyzeFingerAngles(landmarks) {
          const fingerData = {
            thumb: this.isFingerExtended(landmarks, "thumb"),
            index: this.isFingerExtended(landmarks, "index"),
            middle: this.isFingerExtended(landmarks, "middle"),
            ring: this.isFingerExtended(landmarks, "ring"),
            pinky: this.isFingerExtended(landmarks, "pinky"),
          };

          const analysis = {};
          Object.keys(fingerData).forEach((finger) => {
            const isExtended = fingerData[finger].isExtended;
            const confidence = fingerData[finger].confidence;

            analysis[finger] = {
              angle: fingerData[finger].simulatedAngle, // æ¨¡æ‹Ÿè§’åº¦ç”¨äºæ˜¾ç¤º
              threshold: this.ANGLE_THRESHOLDS[finger],
              isExtended: isExtended,
              confidence: confidence,
            };
          });

          return analysis;
        }

        // æ–°çš„æ‰‹æŒ‡è¯†åˆ«æ–¹æ³• - å¢å¼ºé²æ£’æ€§ï¼Œé€‚åº”è§’åº¦å’Œè·ç¦»å˜åŒ–
        isFingerExtended(landmarks, fingerName) {
          let tipIndex,
            pipIndex,
            mcpIndex,
            wristIndex = 0;

          // å®šä¹‰å„æ‰‹æŒ‡çš„å…³é”®ç‚¹ç´¢å¼•
          switch (fingerName) {
            case "thumb":
              tipIndex = 4;
              pipIndex = 3;
              mcpIndex = 2;
              break;
            case "index":
              tipIndex = 8;
              pipIndex = 6;
              mcpIndex = 5;
              break;
            case "middle":
              tipIndex = 12;
              pipIndex = 10;
              mcpIndex = 9;
              break;
            case "ring":
              tipIndex = 16;
              pipIndex = 14;
              mcpIndex = 13;
              break;
            case "pinky":
              tipIndex = 20;
              pipIndex = 18;
              mcpIndex = 17;
              break;
          }

          const tip = landmarks[tipIndex];
          const pip = landmarks[pipIndex];
          const mcp = landmarks[mcpIndex];
          const wrist = landmarks[wristIndex];

          let isExtended = false;
          let confidence = 0.5;
          let simulatedAngle = 90;

          // è®¡ç®—æ‰‹çš„æ•´ä½“å°ºåº¦ï¼ˆç”¨äºè·ç¦»è¡¥å¿ï¼‰
          const handSize = Math.sqrt(
            Math.pow(landmarks[0].x - landmarks[9].x, 2) +
              Math.pow(landmarks[0].y - landmarks[9].y, 2)
          );

          if (fingerName === "thumb") {
            // æ‹‡æŒ‡è¯†åˆ« - åŠ å¼ºä¸å…¶ä»–æ‰‹æŒ‡çš„ç›¸å¯¹ä½ç½®åˆ¤æ–­
            const thumbTipToWrist = Math.sqrt(
              Math.pow(tip.x - wrist.x, 2) + Math.pow(tip.y - wrist.y, 2)
            );
            const thumbMcpToWrist = Math.sqrt(
              Math.pow(mcp.x - wrist.x, 2) + Math.pow(mcp.y - wrist.y, 2)
            );

            const distanceRatio = thumbTipToWrist / thumbMcpToWrist;
            const xDiff = Math.abs(tip.x - mcp.x);
            const yDiff = Math.abs(tip.y - mcp.y);

            // è·å–å…¶ä»–æ‰‹æŒ‡çš„ä¿¡æ¯ç”¨äºç›¸å¯¹ä½ç½®åˆ¤æ–­
            const indexTip = landmarks[8];
            const middleTip = landmarks[12];
            const indexMcp = landmarks[5];
            const middleMcp = landmarks[9];

            // æ£€æŸ¥æ‹‡æŒ‡æ˜¯å¦æ˜æ˜¾çªå‡ºäºå…¶ä»–æ‰‹æŒ‡
            const thumbToIndexDistance = Math.sqrt(
              Math.pow(tip.x - indexTip.x, 2) + Math.pow(tip.y - indexTip.y, 2)
            );
            const thumbToMiddleDistance = Math.sqrt(
              Math.pow(tip.x - middleTip.x, 2) +
                Math.pow(tip.y - middleTip.y, 2)
            );

            // æ‹‡æŒ‡åº”è¯¥æ˜æ˜¾è¿œç¦»é£ŸæŒ‡å’Œä¸­æŒ‡ï¼ˆæ¯”2æ‰‹åŠ¿æ—¶æ‹‡æŒ‡æ˜¯æ”¶èµ·çš„ï¼‰
            const farFromOtherFingers =
              thumbToIndexDistance > 0.12 && thumbToMiddleDistance > 0.12;

            // æ‹‡æŒ‡åº”è¯¥æ¯”é£ŸæŒ‡å’Œä¸­æŒ‡çš„MCPå…³èŠ‚æ›´å¤–ä¾§
            const thumbIsOutside =
              Math.abs(tip.x - indexMcp.x) > 0.08 ||
              Math.abs(tip.x - middleMcp.x) > 0.08;

            // åŸºäºæ‰‹çš„å°ºåº¦è°ƒæ•´é˜ˆå€¼
            const sizeAdjustedXThreshold = Math.max(0.06, handSize * 1.0); // æé«˜é˜ˆå€¼

            // æ›´ä¸¥æ ¼çš„å¤šç§åˆ¤æ–­æ–¹å¼
            const method1 =
              distanceRatio > 1.35 &&
              xDiff > sizeAdjustedXThreshold &&
              farFromOtherFingers; // è·ç¦»+åˆ†ç¦»
            const method2 =
              distanceRatio > 1.25 && thumbIsOutside && xDiff > 0.08; // è·ç¦»+å¤–ä¾§+æ¨ªå‘
            const method3 =
              thumbTipToWrist > thumbMcpToWrist + 0.1 && farFromOtherFingers; // ç»å¯¹è·ç¦»+åˆ†ç¦»

            isExtended = method1 || method2 || method3;
            confidence = isExtended
              ? Math.min(0.95, Math.max(0.5, distanceRatio * 0.6))
              : 0.95;
            simulatedAngle = isExtended ? 150 : 80;

            console.log(
              `ğŸ¤ æ‹‡æŒ‡åˆ†æ: è·ç¦»æ¯”=${distanceRatio.toFixed(
                2
              )}, Xå·®=${xDiff.toFixed(3)}, Yå·®=${yDiff.toFixed(
                3
              )}, è¿œç¦»å…¶ä»–æ‰‹æŒ‡=${farFromOtherFingers}, ä½äºå¤–ä¾§=${thumbIsOutside}, æ–¹æ³•1=${method1}, æ–¹æ³•2=${method2}, æ–¹æ³•3=${method3}, ç»“æœ=${isExtended}`
            );
          } else {
            // å…¶ä»–å››æŒ‡è¯†åˆ« - å¢å¼ºè§’åº¦é€‚åº”æ€§
            const tipY = tip.y;
            const pipY = pip.y;
            const mcpY = mcp.y;

            // åŠ¨æ€è°ƒæ•´é«˜åº¦æ£€æŸ¥çš„å®¹å·®
            const baseTolerance = 0.008; // ç¨å¾®å‡å°åŸºç¡€å®¹å·®
            const sizeTolerance = handSize * 0.15;
            const tolerance = Math.max(baseTolerance, sizeTolerance);

            const tipHigherThanPip = tipY < pipY - tolerance;
            const pipHigherThanMcp = pipY < mcpY - tolerance;

            // è·ç¦»æ£€æŸ¥
            const tipToMcpDistance = Math.sqrt(
              Math.pow(tip.x - mcp.x, 2) + Math.pow(tip.y - mcp.y, 2)
            );
            const pipToMcpDistance = Math.sqrt(
              Math.pow(pip.x - mcp.x, 2) + Math.pow(pip.y - mcp.y, 2)
            );

            const distanceRatio = tipToMcpDistance / pipToMcpDistance;

            // æ ¹æ®æ‰‹çš„å°ºåº¦è°ƒæ•´è·ç¦»é˜ˆå€¼
            const sizeAdjustedDistanceThreshold = Math.max(
              1.18, // ç¨å¾®æé«˜åŸºç¡€é˜ˆå€¼
              1.4 - handSize * 2.5
            );

            const heightCheck = tipHigherThanPip && pipHigherThanMcp;
            const distanceCheck = distanceRatio > sizeAdjustedDistanceThreshold;

            // å¤šé‡åˆ¤æ–­é€»è¾‘
            const method1 = heightCheck && distanceCheck; // ä¸¥æ ¼æ¨¡å¼
            const method2 = heightCheck && distanceRatio > 1.12; // é«˜åº¦ä¼˜å…ˆï¼Œç¨å¾®æé«˜é˜ˆå€¼
            const method3 = distanceCheck && tipY < mcpY - tolerance * 0.3; // è·ç¦»ä¼˜å…ˆ

            isExtended = method1 || method2 || method3;

            // ç½®ä¿¡åº¦è®¡ç®—
            let confidenceScore = 0.4;
            if (tipHigherThanPip) confidenceScore += 0.2;
            if (pipHigherThanMcp) confidenceScore += 0.2;
            if (distanceCheck) confidenceScore += 0.2;

            confidence = Math.min(0.95, confidenceScore);
            simulatedAngle = isExtended ? 160 : 45;

            console.log(
              `ğŸ‘† ${fingerName}åˆ†æ: é«˜åº¦âœ“=${heightCheck}(${tipHigherThanPip},${pipHigherThanMcp}), è·ç¦»âœ“=${distanceCheck}(${distanceRatio.toFixed(
                2
              )}>${sizeAdjustedDistanceThreshold.toFixed(
                2
              )}), å®¹å·®=${tolerance.toFixed(
                3
              )}, æ–¹æ³•1=${method1}, æ–¹æ³•2=${method2}, æ–¹æ³•3=${method3}, ç»“æœ=${isExtended}`
            );
          }

          return {
            isExtended: isExtended,
            confidence: confidence,
            simulatedAngle: simulatedAngle,
          };
        }

        calculateFingerCount(fingerAnalysis) {
          let count = 0;
          let totalConfidence = 0;
          let debugInfo = []; // æ·»åŠ è°ƒè¯•ä¿¡æ¯

          Object.keys(fingerAnalysis).forEach((fingerName) => {
            const finger = fingerAnalysis[fingerName];
            const isExtended =
              finger.isExtended &&
              finger.confidence >= this.CONFIDENCE_THRESHOLD;

            // æ”¶é›†è°ƒè¯•ä¿¡æ¯
            debugInfo.push({
              name: fingerName,
              angle: Math.round(finger.angle),
              threshold: finger.threshold,
              isExtended: finger.isExtended,
              confidence: Math.round(finger.confidence * 100) / 100,
              counted: isExtended,
            });

            if (isExtended) {
              count++;
            }
            totalConfidence += finger.confidence;
          });

          // è¾“å‡ºæ›´è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯
          console.log("ğŸ–ï¸ æ‰‹æŒ‡è¯†åˆ«è¯¦æƒ…:", {
            æ£€æµ‹æ€»æ•°: count,
            ç›®æ ‡æ•°å­—: this.targetNumber,
            è¯¦ç»†ä¿¡æ¯: debugInfo,
            æ€»ä½“ç½®ä¿¡åº¦: Math.round((totalConfidence / 5) * 100) + "%",
            å†å²è®°å½•: this.fingerHistory.slice(-5),
          });

          const overallConfidence = totalConfidence / 5;
          this.algorithmConfidence.textContent = `${Math.round(
            overallConfidence * 100
          )}%`;

          return count;
        }

        updateStabilityAnalysis(currentCount) {
          this.fingerHistory.push(currentCount);
          if (this.fingerHistory.length > this.HISTORY_SIZE) {
            this.fingerHistory.shift();
          }

          const stableCount = this.getMostFrequent(this.fingerHistory);
          this.currentFingers = stableCount;

          // ç«‹å³æ›´æ–°æ˜¾ç¤ºï¼Œä¸ç­‰å¾…ç¨³å®šæ€§æ£€æŸ¥
          this.currentDetection.textContent = `${this.currentFingers} æ ¹æ‰‹æŒ‡`;
          this.updateStabilityIndicator();

          console.log(
            `ğŸ“Š ç¨³å®šæ€§åˆ†æ: å½“å‰=${currentCount}, ç¨³å®šå€¼=${stableCount}, å†å²=${this.fingerHistory.join(
              ","
            )}`
          );
        }

        getMostFrequent(arr) {
          if (arr.length === 0) return 0;

          const frequency = {};
          let maxCount = 0;
          let mostFrequent = 0;

          arr.forEach((num) => {
            frequency[num] = (frequency[num] || 0) + 1;
            if (frequency[num] > maxCount) {
              maxCount = frequency[num];
              mostFrequent = num;
            }
          });

          return mostFrequent;
        }

        updateStabilityIndicator() {
          const dots =
            this.stabilityIndicator.querySelectorAll(".stability-dot");
          const recentHistory = this.fingerHistory.slice(-5);
          const isStable =
            recentHistory.length >= 3 &&
            recentHistory
              .slice(-3)
              .every(
                (count) => count === recentHistory[recentHistory.length - 1]
              );

          dots.forEach((dot, index) => {
            if (
              index < recentHistory.length &&
              recentHistory[index] === this.currentFingers
            ) {
              dot.classList.add("active");
            } else {
              dot.classList.remove("active");
            }
          });

          if (isStable) {
            this.detectionPrecision.textContent = "ç¨³å®š";
          } else {
            this.detectionPrecision.textContent = "æ£€æµ‹ä¸­";
          }
        }

        updateFingerDisplay(fingerAnalysis) {
          const fingerNames = ["thumb", "index", "middle", "ring", "pinky"];

          fingerNames.forEach((finger) => {
            const analysis = fingerAnalysis[finger];

            this.angleElements[finger].textContent = `${Math.round(
              analysis.angle
            )}Â°`;

            const indicator = this.indicatorElements[finger];
            if (analysis.isExtended) {
              indicator.classList.add("extended");
              indicator.classList.remove("folded");
            } else {
              indicator.classList.add("folded");
              indicator.classList.remove("extended");
            }
          });
        }

        updateDetectionInfo(fingerAnalysis, palmSize) {
          const avgConfidence =
            Object.values(fingerAnalysis).reduce(
              (sum, finger) => sum + finger.confidence,
              0
            ) / 5;

          this.confidenceDisplay.textContent = `ç½®ä¿¡åº¦: ${Math.round(
            avgConfidence * 100
          )}%`;
        }

        calculatePalmSize(landmarks) {
          const wrist = landmarks[0];
          const middleBase = landmarks[9];
          return Math.sqrt(
            Math.pow(wrist.x - middleBase.x, 2) +
              Math.pow(wrist.y - middleBase.y, 2)
          );
        }

        drawAdvancedHandLandmarks(landmarks) {
          const ctx = this.canvasContext;

          this.drawHandSkeleton(landmarks);

          landmarks.forEach((landmark, index) => {
            const x = landmark.x * this.outputCanvas.width;
            const y = landmark.y * this.outputCanvas.height;

            ctx.beginPath();
            ctx.arc(x, y, 3, 0, 2 * Math.PI);

            if ([4, 8, 12, 16, 20].includes(index)) {
              ctx.fillStyle = "#ff4757";
              ctx.fill();
              ctx.beginPath();
              ctx.arc(x, y, 5, 0, 2 * Math.PI);
              ctx.strokeStyle = "#fff";
              ctx.lineWidth = 2;
              ctx.stroke();
            } else if ([3, 7, 11, 15, 19].includes(index)) {
              ctx.fillStyle = "#3742fa";
              ctx.fill();
            } else {
              ctx.fillStyle = "#ffd700";
              ctx.fill();
            }
          });
        }

        drawHandSkeleton(landmarks) {
          const ctx = this.canvasContext;
          const connections = [
            [0, 1],
            [1, 2],
            [2, 3],
            [3, 4],
            [0, 5],
            [5, 6],
            [6, 7],
            [7, 8],
            [0, 9],
            [9, 10],
            [10, 11],
            [11, 12],
            [0, 13],
            [13, 14],
            [14, 15],
            [15, 16],
            [0, 17],
            [17, 18],
            [18, 19],
            [19, 20],
          ];

          ctx.strokeStyle = "rgba(255, 215, 0, 0.6)";
          ctx.lineWidth = 2;

          connections.forEach(([start, end]) => {
            const startPoint = landmarks[start];
            const endPoint = landmarks[end];

            ctx.beginPath();
            ctx.moveTo(
              startPoint.x * this.outputCanvas.width,
              startPoint.y * this.outputCanvas.height
            );
            ctx.lineTo(
              endPoint.x * this.outputCanvas.width,
              endPoint.y * this.outputCanvas.height
            );
            ctx.stroke();
          });
        }

        processStableGesture() {
          if (!this.isGameActive) return;

          const recentHistory = this.fingerHistory.slice(-5);
          const isConsistent =
            recentHistory.length >= 3 &&
            recentHistory
              .slice(-3)
              .every((count) => count === this.currentFingers);

          if (
            isConsistent &&
            this.currentFingers >= 1 &&
            this.currentFingers <= 5
          ) {
            this.stableFrames++;
            const progress = (this.stableFrames / this.REQUIRED_FRAMES) * 100;
            this.updateProgress(progress);

            if (this.stableFrames >= this.REQUIRED_FRAMES) {
              this.confirmGesture();
            }
          } else {
            this.resetStableGesture();
          }
        }

        updateProgress(progress) {
          this.progressFill.style.width = `${progress}%`;
          if (progress > 0) {
            this.progressText.textContent = `ç¡®è®¤ä¸­... ${Math.round(
              progress
            )}%`;
          } else {
            this.progressText.textContent = "ç­‰å¾…ç¨³å®šæ‰‹åŠ¿...";
          }
        }

        confirmGesture() {
          this.resetStableGesture();
          this.handleUserInput(this.currentFingers);
        }

        resetStableGesture() {
          this.stableFrames = 0;
          this.updateProgress(0);
        }

        resetDetection() {
          // å¦‚æœç­‰å¾…ä¸‹ä¸€è½®ä¸”ç”¨æˆ·æ”¾ä¸‹æ‰‹ï¼Œç”Ÿæˆæ–°æ•°å­—
          if (this.waitingForNextRound) {
            this.waitingForNextRound = false;
            this.generateTargetNumber();
            this.feedback.textContent = "æ–°ç›®æ ‡å·²ç”Ÿæˆï¼Œè¯·æ¯”å‡ºå¯¹åº”æ‰‹æŒ‡æ•°é‡";
            this.feedback.className = "feedback hint";
            console.log("ğŸ¯ ç”¨æˆ·æ”¾ä¸‹æ‰‹ï¼Œç”Ÿæˆæ–°ç›®æ ‡æ•°å­—");
          }

          this.currentFingers = 0;
          this.fingerHistory = [];
          this.resetStableGesture();
          this.currentDetection.textContent = "æ— æ‰‹åŠ¿æ£€æµ‹";
          this.confidenceDisplay.textContent = "ç½®ä¿¡åº¦: ç­‰å¾…ä¸­...";
          this.algorithmConfidence.textContent = "0%";
          this.detectionPrecision.textContent = "ç­‰å¾…ä¸­";

          Object.values(this.angleElements).forEach((element) => {
            element.textContent = "--Â°";
          });

          Object.values(this.indicatorElements).forEach((indicator) => {
            indicator.classList.remove("extended");
            indicator.classList.add("folded");
          });
        }

        handleUserInput(userInput) {
          if (!this.isGameActive) return;

          if (userInput === this.targetNumber) {
            this.score++;
            this.updateScore();
            this.showSuccess();
          } else {
            this.showError(userInput);
          }
        }

        showSuccess() {
          this.targetNumberDisplay.classList.add("correct");
          this.feedback.textContent = `âœ… è¯†åˆ«æ­£ç¡®ï¼+1åˆ† (${
            this.themes[this.currentThemeName].name
          }) - ä¿æŒæ‰‹åŠ¿ç¨³å®šï¼Œç­‰å¾…ä¸‹ä¸€é¢˜`;
          this.feedback.className = "feedback success";

          // ä¸è‡ªåŠ¨åˆ‡æ¢æ•°å­—ï¼Œè®©ç”¨æˆ·æ§åˆ¶èŠ‚å¥
          setTimeout(() => {
            this.targetNumberDisplay.classList.remove("correct");
            this.feedback.textContent = "å‡†å¤‡å¥½åè¯·æ”¾ä¸‹æ‰‹ï¼Œç­‰å¾…ä¸‹ä¸€ä¸ªæ•°å­—";
            this.feedback.className = "feedback hint";

            // è®¾ç½®æ ‡å¿—ä½ï¼Œè¡¨ç¤ºç­‰å¾…ç”¨æˆ·å‡†å¤‡ä¸‹æ¬¡
            this.waitingForNextRound = true;
            this.resetStableGesture();
          }, 2000);
        }

        showError(userInput) {
          this.targetNumberDisplay.classList.add("wrong");
          this.feedback.textContent = `âŒ è¯†åˆ«: ${userInput}æ ¹, ç›®æ ‡: ${this.targetNumber}æ ¹ - è¯·é‡è¯•`;
          this.feedback.className = "feedback error";

          setTimeout(() => {
            this.targetNumberDisplay.classList.remove("wrong");
            this.showHint();
          }, 2500); // ç¨å¾®å»¶é•¿é”™è¯¯æ˜¾ç¤ºæ—¶é—´
        }

        showHint() {
          this.feedback.textContent = "è¯·æ¯”å‡ºå¯¹åº”æ‰‹æŒ‡æ•°é‡ï¼Œå¯åˆ‡æ¢ä¸»é¢˜ä½“éªŒ";
          this.feedback.className = "feedback hint";
        }

        updateScore() {
          this.scoreDisplay.textContent = this.score;
        }

        generateTargetNumber() {
          this.targetNumber = Math.floor(Math.random() * 5) + 1;
          this.targetNumberDisplay.textContent = this.targetNumber;

          const fingerEmojis = ["", "â˜ï¸", "âœŒï¸", "ğŸ¤Ÿ", "ğŸ––", "âœ‹"];
          this.fingerGuide.textContent =
            fingerEmojis[this.targetNumber] || "âœ‹";

          this.resetStableGesture();
        }

        addEventListeners() {
          this.restartBtn.addEventListener("click", () => {
            this.restartGame();
          });
        }

        restartGame() {
          // ç»“æŸå½“å‰æ¸¸æˆæ•°æ®ä¸Šä¼ 
          if (this.dataUploader) {
            this.dataUploader.endGame(this.score);
          }
          
          this.score = 0;
          this.waitingForNextRound = false; // é‡ç½®ç­‰å¾…çŠ¶æ€
          this.updateScore();
          this.generateTargetNumber();
          this.showHint();
          this.resetDetection();

          // é‡æ–°å¯åŠ¨æ•°æ®ä¸Šä¼ å™¨
          this.dataUploader = new GameDataUploader('cognitive', 102); // è®¤çŸ¥èƒ½åŠ›è®­ç»ƒï¼Œæé˜¿å§¨
          this.dataUploader.setScoreCallback(() => this.score);
          this.dataUploader.startGame(this.score);

          // ğŸ¯ æ’­æ”¾é‡æ–°å¼€å§‹éŸ³æ•ˆï¼ˆä¸»é¢˜è‰²å½©åŒ–ï¼‰
          this.playThemeChangeSound();
        }

        startGame() {
          this.isGameActive = true;
          
          // åˆå§‹åŒ–æ•°æ®ä¸Šä¼ å™¨
          this.dataUploader = new GameDataUploader('cognitive', 102); // è®¤çŸ¥èƒ½åŠ›è®­ç»ƒï¼Œæé˜¿å§¨
          this.dataUploader.setScoreCallback(() => this.score);
          this.dataUploader.startGame(this.score);
          
          console.log("ğŸ® ä¸»é¢˜å¢å¼ºç‰ˆæ¸¸æˆå·²å¯åŠ¨");
          console.log("ğŸ¨ ä¸»é¢˜ç³»ç»Ÿç‰¹ç‚¹:");
          console.log("  âœ… 4ç§é«˜çº§é…è‰²ä¸»é¢˜");
          console.log("  âœ… ä¸€é”®åˆ‡æ¢ï¼Œä¿å­˜åå¥½");
          console.log("  âœ… å¹³æ»‘è¿‡æ¸¡åŠ¨ç”»");
          console.log("  âœ… é›†æˆé«˜ç²¾åº¦è¯†åˆ«ç®—æ³•");
          console.log(
            `  âœ… å½“å‰ä¸»é¢˜: ${this.themes[this.currentThemeName].name}`
          );
        }

        // ç§»é™¤æ—§çš„æ•°æ®ä¸Šä¼ ç›¸å…³åŠŸèƒ½
        // startDataUpload() {
        //   // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
        //   if (this.uploadInterval) {
        //     clearInterval(this.uploadInterval);
        //   }
        //   
        //   // æ¯30ç§’ä¸Šä¼ ä¸€æ¬¡æ•°æ®
        //   this.uploadInterval = setInterval(() => {
        //     this.uploadGameData();
        //   }, 15000); // æ”¹ä¸º15ç§’
        // }

        // uploadGameData() {
        //   const currentTime = Date.now();
        //   const gameDuration = Math.floor((currentTime - this.gameStartTime) / 1000);
        //   const scoreIncrease = this.score - this.lastUploadScore;
        //   
        //   if (scoreIncrease > 0 || gameDuration > 0) {
        //     const data = {
        //       patientId: 102, // æé˜¿å§¨çš„ID
        //       gameType: 'number', // æ ‡è¯†è¿™æ˜¯æ•°å­—è®¤çŸ¥æ¸¸æˆ
        //       scoreIncrease: scoreIncrease,
        //       timeIncrease: 15, // 15ç§’æ—¶é—´é—´éš”
        //       timestamp: new Date().toISOString()
        //     };

        //     try {
        //       // Method 1: Try to send via postMessage to parent window
        //       if (window.parent && window.parent !== window) {
        //         window.parent.postMessage({
        //           type: 'GAME_DATA_UPLOAD',
        //           data: data
        //         }, '*');
        //       }
        //       
        //       // Method 2: Store in localStorage for healthcare workstation
        //       const existingData = JSON.parse(localStorage.getItem('gameUploadData') || '[]');
        //       existingData.push(data);
        //       localStorage.setItem('gameUploadData', JSON.stringify(existingData));
        //       
        //       // Method 3: Try to send to opener window
        //       if (window.opener) {
        //         window.opener.postMessage({
        //           type: 'GAME_DATA_UPLOAD',
        //           data: data
        //         }, '*');
        //       }
        //       
        //       console.log('è®¤çŸ¥æ¸¸æˆæ•°æ®å·²ä¸Šä¼ :', data);
        //       
        //       // æ˜¾ç¤ºä¸Šä¼ æç¤º
        //       this.showUploadNotification(data.scoreIncrease, data.timeIncrease);
        //       
        //       // æ›´æ–°ä¸Šæ¬¡ä¸Šä¼ çš„å¾—åˆ†
        //       this.lastUploadScore = this.score;
        //       
        //     } catch (error) {
        //       console.error('ä¸Šä¼ è®¤çŸ¥æ¸¸æˆæ•°æ®å¤±è´¥:', error);
        //     }
        //   }
        // }
        
        // ç§»é™¤æ—§çš„æ˜¾ç¤ºæ•°æ®ä¸Šä¼ æç¤ºæ–¹æ³•
        // showUploadNotification(scoreIncrease, timeIncrease) {
        //   // åˆ›å»ºæç¤ºå…ƒç´ 
        //   const notificationEl = document.createElement('div');
        //   notificationEl.className = 'upload-notification';
        //   notificationEl.innerHTML = `
        //     <div class="upload-notification-content">
        //       <span>æ•°æ®å·²ä¸Šä¼ : å¾—åˆ†+${scoreIncrease}, æ—¶é•¿+${timeIncrease}ç§’</span>
        //     </div>
        //   `;
        //   
        //   // æ·»åŠ æ ·å¼
        //   notificationEl.style.cssText = `
        //     position: fixed;
        //     top: 20px;
        //     right: 20px;
        //     background: rgba(76, 175, 80, 0.9);
        //     color: white;
        //     padding: 10px 15px;
        //     border-radius: 5px;
        //     z-index: 10000;
        //     font-family: Inter, sans-serif;
        //     font-size: 14px;
        //     box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        //     transition: all 0.3s ease;
        //   `;
        //   
        //   // æ·»åŠ åˆ°é¡µé¢
        //   document.body.appendChild(notificationEl);
        //   
        //   // 2ç§’åç§»é™¤
        //   setTimeout(() => {
        //     notificationEl.style.opacity = '0';
        //     setTimeout(() => {
        //       if (notificationEl.parentNode) {
        //         notificationEl.parentNode.removeChild(notificationEl);
        //       }
        //     }, 300);
        //   }, 2000);
        // }
      }

      // åˆå§‹åŒ–æ¸¸æˆ
      document.addEventListener("DOMContentLoaded", () => {
        try {
          console.log('ğŸš€ è®¤çŸ¥è®­ç»ƒæ¸¸æˆå¼€å§‹åˆå§‹åŒ–...');
          console.log('ğŸŒ å½“å‰ç¯å¢ƒ:', {
            protocol: window.location.protocol,
            host: window.location.host,
            userAgent: navigator.userAgent,
            hasGetUserMedia: !!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia),
            hasMediaPipe: typeof Hands !== "undefined" && typeof Camera !== "undefined"
          });

          if (typeof Hands === "undefined" || typeof Camera === "undefined") {
            console.error("âŒ MediaPipeåº“åŠ è½½å¤±è´¥");
            alert("MediaPipeåº“åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•\n\nå¯èƒ½åŸå› ï¼š\n1. ç½‘ç»œè¿æ¥é—®é¢˜\n2. CDNæœåŠ¡ä¸å¯ç”¨\n\nè§£å†³æ–¹æ¡ˆï¼š\n1. åˆ·æ–°é¡µé¢\n2. æ£€æŸ¥ç½‘ç»œè¿æ¥");
            return;
          }

          // æ˜¾ç¤ºç¯å¢ƒä¿¡æ¯ç»™ç”¨æˆ·
          const isHTTPS = window.location.protocol === 'https:';
          const supportCamera = !!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia);
          
          if (!isHTTPS && window.location.hostname !== 'localhost') {
            console.warn('âš ï¸ å½“å‰ä½¿ç”¨HTTPåè®®ï¼Œæ‘„åƒå¤´åŠŸèƒ½å¯èƒ½å—é™');
          }
          
          if (!supportCamera) {
            console.warn('âš ï¸ å½“å‰æµè§ˆå™¨ä¸æ”¯æŒæ‘„åƒå¤´API');
          }

          const game = new ThemeEnhancedGame();
          console.log('âœ… è®¤çŸ¥è®­ç»ƒæ¸¸æˆåˆå§‹åŒ–å®Œæˆ');
        } catch (error) {
          console.error('âŒ æ¸¸æˆåˆå§‹åŒ–å¤±è´¥:', error);
          alert(`æ¸¸æˆåˆå§‹åŒ–å¤±è´¥: ${error.message}\n\nè¯·åˆ·æ–°é¡µé¢é‡è¯•`);
        }
      });
    </script>
  </body>
</html>
